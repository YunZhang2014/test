<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Fade in</title>
    <link href="../css/jquery-ui.css" rel="stylesheet">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css"
          integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
    <style>
        .ui-menu{width: 200px}

        #message{
            font-size:1em;
            width: 250px;
            height: 100px;
        }
    </style>
</head>
<body>

<div id="composer">
    <h3>Message Composer</h3>
    <textarea id="message"></textarea>
</div>

<ul id="menu">
    <li>
        <span class="ui-icon ui-icon-folder-open"></span>Load
    </li>
    <li class="ui-state-disabled" id="save-option">
        <span class="ui-icon ui-icon-disk"></span>Save
    </li>
    <li></li>
    <li>
        <span class="ui-icon ui-icon-trash"></span>Delete
    </li>
    <li>
        <span class="ui-icon ui-icon-gear"></span>Settings
    </li>
</ul>

<div id="confirmDelete">
    <p>Are you <strong>sure</strong> you want to delete your message?</p>
</div>

<script src="https://code.jquery.com/jquery-1.12.2.js" integrity="sha256-VUCyr0ZXB5VhBibo2DkTVhdspjmxUgxDGaLQx7qb7xY="
        crossorigin="anonymous"></script>
<script src="../js/jquery-ui.js"></script>
<script>
    var menu = $('#menu').menu({
        select: function (event, ui) {
            var selection = $.trim(ui.item.text()),
                    message = $('#message').val();

            switch (selection) {
                case "Load":
                    loadMessage();
                    break;
                case "Save":
                    localStorage.setItem( "message", message );
                    break;
                case "Delete":
                    $('#confirmDelete').dialog('open');
                    break;
            }
        }
    });

    function loadMessage() {
        var message,
                dialog = $('<div>').dialog({
                        modal: true,
                        title: 'Loading...'
                }),
                progressbar = $('<div>').progressbar({value:false});
        dialog.append(progressbar);
        setTimeout(function () {
            message = localStorage.getItem( "message" );
            $( "#message" ).val( message );
            dialog.remove();
        }, Math.random() * 5000);
    }

    $('#confirmDelete').dialog({
        autoOpen: false,
        buttons: [
                {
                    text: 'Cancel',
                    click: function () {
                        $(this).dialog('close');
                    }
                },
                {
                    text: "Yeah, Let's Do It",
                    click: function () {
                        deleteMessage();
                        $(this).dialog('close');
                    },
                    class: 'primary'
                }],
        minWidth: 400,
        modal: true
    });

    function deleteMessage() {
        $( "#message" ).val( "" );
        localStorage.removeItem( "message", "" );
    }

    $('#message').on('keyup',function () {
        var message = $(this).val();
        if (message.length === 0){
            $('#save-option').addClass('ui-state-disabled');
        }else{
            $('#save-option').removeClass('ui-state-disabled');
        }
        menu.menu( "refresh" );
    });

    //setting dialog
    $( "#settingsDialog" ).dialog({
        autoOpen: false,
        title: "Settings"
    });

    $('#slider').slider({
        range: 'min',
        value: 1,
        min: 0.5,
        max: 2.5,
        step: 0.1,
        slide: function (event,ui) {
           $('#message').css('font-size',ui.value + "em");
        }
    });

    $('#menu li:first').tooltip({
        content: function () {
            var message = localStorage.getItem('message');
            if (message && message.length > 20){
                return message.substring(0,20) + '...';
            }else{
                return message;
            }
        },
        items: '*',
        show: {delay: 300},
        position:{
            my: 'left center',
            at: 'right center'
        }
    });
</script>
</body>
</html>